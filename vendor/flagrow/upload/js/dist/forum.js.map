{"version":3,"sources":["webpack://module.exports/webpack/bootstrap","webpack://module.exports/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://module.exports/./src/forum/components/DragAndDrop.js","webpack://module.exports/./src/forum/components/PasteClipboard.js","webpack://module.exports/./src/forum/components/UploadButton.js","webpack://module.exports/./src/forum/downloadButtonInteraction.js","webpack://module.exports/./src/forum/index.js","webpack://module.exports/external \"flarum.core.compat['Component']\"","webpack://module.exports/external \"flarum.core.compat['components/LoadingIndicator']\"","webpack://module.exports/external \"flarum.core.compat['components/Post']\"","webpack://module.exports/external \"flarum.core.compat['components/TextEditor']\"","webpack://module.exports/external \"flarum.core.compat['extend']\"","webpack://module.exports/external \"flarum.core.compat['helpers/icon']\""],"names":["DragAndDrop","uploadButton","initialized","textarea","$","on","in","bind","out","dropping","isDropping","over","e","preventDefault","toggleClass","addClass","m","redraw","uploadFiles","originalEvent","dataTransfer","files","then","removeClass","PasteClipboard","document","addEventListener","paste","clipboardData","items","i","length","type","indexOf","push","getAsFile","UploadButton","init","textAreaObj","uploading","prop","view","button","className","app","translator","trans","component","multiple","onchange","process","data","FormData","append","request","method","url","forum","attribute","serialize","raw","success","failure","message","response","forEach","bbcode","insertAtCursor","props","preview","setTimeout","getElementById","reset","extend","prototype","isInitialized","unbind","stopPropagation","currentTarget","attr","post","id","session","csrfToken","window","open","initializers","add","drag","clipboard","hide","hover","show","downloadButtonInteraction"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","export default class DragAndDrop {\n\n    constructor(uploadButton) {\n\n        if (this.initialized) return;\n\n        this.uploadButton = uploadButton;\n\n        this.textarea = $(\"#composer .Composer\");\n\n        $(this.textarea).on('dragover', this.in.bind(this));\n\n        $(this.textarea).on('dragleave', this.out.bind(this));\n        $(this.textarea).on('dragend', this.out.bind(this));\n\n        $(this.textarea).on('drop', this.dropping.bind(this));\n\n        this.isDropping = this.over = false;\n        this.initialized = true;\n    }\n\n    in(e) {\n        e.preventDefault();\n\n        if (!this.over) {\n            this.textarea.toggleClass('flagrow-upload-dragging', true);\n            this.over = true;\n        }\n    }\n\n    out(e) {\n        e.preventDefault();\n\n        if (this.over) {\n            this.textarea.toggleClass('flagrow-upload-dragging', false);\n            this.over = false;\n        }\n    }\n\n    dropping(e) {\n        e.preventDefault();\n\n        if (!this.isDropping) {\n\n            this.isDropping = true;\n            this.textarea.addClass('flagrow-dropping');\n\n            m.redraw();\n\n            this.uploadButton.uploadFiles(e.originalEvent.dataTransfer.files)\n                .then(() => {\n                    this.textarea.removeClass('flagrow-dropping');\n                    this.isDropping = false;\n                });\n        }\n\n    }\n}\n","export default class PasteClipboard {\n    constructor(uploadButton) {\n        if (this.initialized) return;\n\n        this.uploadButton = uploadButton;\n\n        document.addEventListener('paste', this.paste.bind(this));\n    }\n\n    paste(e) {\n        if (e.clipboardData && e.clipboardData.items) {\n            var items = e.clipboardData.items;\n\n            var files = [];\n\n            for (var i = 0; i < items.length; i++) {\n                if (items[i].type.indexOf('image') !== -1) {\n                    files.push(items[i].getAsFile());\n                }\n            }\n\n            if (files.length > 0) {\n                m.redraw();\n\n                this.uploadButton.uploadFiles(files);\n            }\n        }\n    }\n}\n","import Component from \"flarum/Component\";\nimport icon from \"flarum/helpers/icon\";\nimport LoadingIndicator from \"flarum/components/LoadingIndicator\";\n\nexport default class UploadButton extends Component {\n\n    /**\n     * Load the configured remote uploader service.\n     */\n    init() {\n        // the service type handling uploads\n        this.textAreaObj = null;\n\n        // initial state of the button\n        this.uploading = m.prop(false);\n    }\n\n    /**\n     * Show the actual Upload Button.\n     *\n     * @returns {*}\n     */\n    view() {\n        let button = m('span', {className: 'Button-label'}, app.translator.trans('flagrow-upload.forum.buttons.attach'));\n\n        if (this.uploading()) {\n            button = m('span', {className: 'Button-label uploading'}, app.translator.trans('flagrow-upload.forum.states.loading'));\n        }\n\n        return m('div', {className: 'Button hasIcon flagrow-upload-button Button--icon ' + (this.uploading() ? 'uploading' : '')}, [\n            this.uploading() ? LoadingIndicator.component({className: 'Button-icon'}) : icon('fas fa-file-upload', {className: 'Button-icon'}),\n            button,\n            m('form#flagrow-upload-form', [\n                m('input', {\n                    type: 'file',\n                    multiple: true,\n                    onchange: this.process.bind(this)\n                })\n            ])\n        ]);\n    }\n\n    /**\n     * Process the upload event.\n     *\n     * @param e\n     */\n    process(e) {\n        // get the file from the input field\n        let files = $('form#flagrow-upload-form input').prop('files');\n\n        // set the button in the loading state (and redraw the element!)\n        this.uploading(true);\n\n        this.uploadFiles(files);\n    }\n\n    uploadFiles(files) {\n        const data = new FormData;\n\n        for (let i = 0; i < files.length; i++) {\n            data.append('files[]', files[i]);\n        }\n\n        // send a POST request to the api\n        return app.request({\n            method: 'POST',\n            url: app.forum.attribute('apiUrl') + '/flagrow/upload',\n            // prevent JSON.stringify'ing the form data in the XHR call\n            serialize: raw => raw,\n            data\n        }).then(\n            this.success.bind(this),\n            this.failure.bind(this)\n        );\n    }\n\n    /**\n     * Handles errors.\n     *\n     * @param message\n     */\n    failure(message) {\n        // todo show popup\n    }\n\n    /**\n     * Appends the file's link to the body of the composer.\n     *\n     * @param file\n     */\n    success(response) {\n        response.forEach((bbcode) => {\n          this.textAreaObj.insertAtCursor(bbcode + '\\n');\n        })\n\n        // if we are not starting a new discussion, the variable is defined\n        if (typeof this.textAreaObj.props.preview !== 'undefined') {\n            // show what we just uploaded\n            this.textAreaObj.props.preview();\n        }\n\n        // reset the button for a new upload\n        setTimeout(() => {\n            document.getElementById(\"flagrow-upload-form\").reset();\n            this.uploading(false);\n        }, 1000);\n    }\n}\n","import {extend} from \"flarum/extend\";\nimport Post from 'flarum/components/Post';\n\nexport default function () {\n    extend(Post.prototype, 'config', function (isInitialized) {\n        if (isInitialized) return;\n\n        this.$('.flagrow-download-button[data-uuid]').unbind('click').on('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n\n            let url = app.forum.attribute('apiUrl') + '/flagrow/download';\n\n            url += '/' + $(e.currentTarget).attr('data-uuid');\n            url += '/' + this.props.post.id();\n            url += '/' + app.session.csrfToken;\n\n            window.open(url);\n        })\n    })\n}\n","import {extend} from \"flarum/extend\";\nimport TextEditor from \"flarum/components/TextEditor\";\nimport UploadButton from \"./components/UploadButton\";\nimport DragAndDrop from \"./components/DragAndDrop\";\nimport PasteClipboard from \"./components/PasteClipboard\";\n\nimport downloadButtonInteraction from './downloadButtonInteraction';\n\napp.initializers.add('flagrow-upload', app => {\n    let uploadButton,\n        drag,\n        clipboard;\n\n    extend(TextEditor.prototype, 'controlItems', function (items) {\n        // check whether the user can upload images. If not, returns.\n        if (!app.forum.attribute('canUpload')) return;\n\n        // create and add the button\n        uploadButton = new UploadButton;\n        uploadButton.textAreaObj = this;\n        items.add('flagrow-upload', uploadButton, 0);\n\n        // animate the button on hover: shows the label\n        $('.Button-label', '.item-flagrow-upload > div:not(.uploading)').hide();\n        $('.item-flagrow-upload > div:not(.uploading)').hover(\n            function () {\n                $('.Button-label', this).show();\n                $(this).removeClass('Button--icon')\n            },\n            function () {\n                $('.Button-label', this).hide();\n                $(this).addClass('Button--icon')\n            }\n        );\n    });\n\n    extend(TextEditor.prototype, 'configTextarea', function() {\n        // check whether the user can upload images. If not, returns.\n        if (!app.forum.attribute('canUpload')) return;\n\n        if (!drag) {\n            drag = new DragAndDrop(uploadButton);\n        }\n        if (!clipboard) {\n            clipboard = new PasteClipboard(uploadButton);\n        }\n    });\n\n    downloadButtonInteraction();\n});\n","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['components/LoadingIndicator'];","module.exports = flarum.core.compat['components/Post'];","module.exports = flarum.core.compat['components/TextEditor'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['helpers/icon'];"],"sourceRoot":""}